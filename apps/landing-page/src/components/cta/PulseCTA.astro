---
import { cn } from "@repo/ui/lib/utils";
---

<section id="pulse-cta" class="relative z-20 py-32 w-full bg-background overflow-hidden">
  <!-- Fluid Background -->
  <div class="absolute inset-0 -z-10 bg-background">
    <div id="cta-glow-1" class="absolute top-1/4 left-1/4 h-[400px] w-[400px] rounded-full bg-primary/10 blur-[120px]"></div>
    <div id="cta-glow-2" class="absolute bottom-1/4 right-1/4 h-[500px] w-[500px] rounded-full bg-orange-500/10 blur-[150px]"></div>
    
    <!-- Animated Grid Pattern -->
    <div class="absolute inset-0 opacity-[0.03] dark:opacity-[0.07] [mask-image:radial-gradient(ellipse_at_center,black,transparent_80%)]">
      <div class="absolute inset-0 grid-bg"></div>
    </div>
  </div>

  <div class="container mx-auto px-6 relative">
    <div class="max-w-4xl mx-auto text-center">
      <h2 id="cta-heading" class="text-5xl md:text-8xl font-black tracking-tighter mb-8 leading-[0.9]">
        READY TO <br/> <span class="bg-gradient-to-r from-primary to-orange-500 bg-clip-text text-transparent">LAUNCH?</span>
      </h2>
      
      <p id="cta-text" class="text-xl md:text-2xl text-muted-foreground mb-12 max-w-2xl mx-auto font-medium">
        Join the elite creators who schedule with speed and precision.
      </p>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-6">
        <button id="cta-primary" class="cta-magnetic group relative flex h-16 items-center justify-center overflow-hidden rounded-full bg-primary px-10 text-lg font-bold text-primary-foreground shadow-[0_0_40px_-10px_rgba(var(--primary),0.5)]">
          <span class="absolute inset-0 bg-white/20 translate-y-[100%] transition-transform duration-300 group-hover:translate-y-0"></span>
          <span class="relative z-10">Start Your Journey</span>
        </button>
        
        <button id="cta-secondary" class="cta-magnetic group flex h-16 items-center justify-center rounded-full border border-border bg-background/50 px-10 text-lg font-bold backdrop-blur-md transition-all hover:bg-accent">
          Compare Plans
        </button>
      </div>

      <div id="cta-footer" class="mt-16 text-xs uppercase tracking-[0.3em] text-muted-foreground opacity-50">
        Trusted by 10,000+ Power Users
      </div>
    </div>
  </div>
</section>

<style>
  .grid-bg {
    background-image: linear-gradient(to right, currentColor 1px, transparent 1px),
                      linear-gradient(to bottom, currentColor 1px, transparent 1px);
    background-size: 40px 40px;
    height: 100%;
    width: 100%;
  }

  /* Magnetic effect requires pointer events */
  .cta-magnetic {
    transition: transform 0.1s ease-out;
  }
</style>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const initPulseCTA = () => {
    const section = document.getElementById('pulse-cta');
    const heading = document.getElementById('cta-heading');
    const text = document.getElementById('cta-text');
    const magnets = document.querySelectorAll('.cta-magnetic');
    
    if (!section) return;

    // --- 1. Reveal Animation ---
    gsap.from(heading, {
      scrollTrigger: {
        trigger: section,
        start: "top 80%",
      },
      y: 100,
      opacity: 0,
      duration: 1.5,
      ease: "power4.out"
    });

    gsap.from([text, '#cta-footer'], {
      scrollTrigger: {
        trigger: section,
        start: "top 75%",
      },
      y: 40,
      opacity: 0,
      duration: 1.2,
      stagger: 0.2,
      ease: "power3.out"
    });

    // --- 2. Fluid Glow Background ---
    gsap.to('#cta-glow-1', {
      x: '30%',
      y: '-20%',
      scale: 1.2,
      duration: 8,
      repeat: -1,
      yoyo: true,
      ease: "sine.inOut"
    });

    gsap.to('#cta-glow-2', {
      x: '-20%',
      y: '10%',
      scale: 1.1,
      duration: 10,
      repeat: -1,
      yoyo: true,
      ease: "sine.inOut"
    });

    // --- 3. Magnetic Hover Effect ---
    magnets.forEach((btn) => {
      const element = btn as HTMLElement;
      
      element.addEventListener('mousemove', (e) => {
        const rect = element.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;
        
        gsap.to(element, {
          x: x * 0.4,
          y: y * 0.4,
          scale: 1.1,
          duration: 0.3,
          ease: "power2.out"
        });
      });

      element.addEventListener('mouseleave', () => {
        gsap.to(element, {
          x: 0,
          y: 0,
          scale: 1,
          duration: 0.7,
          ease: "elastic.out(1, 0.3)"
        });
      });
    });
  };

  document.addEventListener('astro:page-load', initPulseCTA);
  initPulseCTA();
</script>
