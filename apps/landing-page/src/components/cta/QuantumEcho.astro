---
import { cn } from "@repo/ui/lib/utils";
import OrbitalField from "../backgrounds/OrbitalField.astro";
---

<section id="quantum-cta" class="relative z-30 py-40 w-full overflow-hidden flex items-center justify-center min-h-[80vh] bg-background">
  
  <!-- Background Pattern (Theme Aware) -->
  <div class="absolute inset-0 z-0">
    <OrbitalField />
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-primary/10 via-transparent to-transparent opacity-40 pointer-events-none"></div>
  </div>
  
  <div class="container relative z-10 mx-auto px-6 text-center">
    
    <!-- Content Wrapper -->
    <div class="flex flex-col items-center justify-center space-y-10">
      
      <!-- Headline -->
      <div class="space-y-4 max-w-4xl mx-auto">
        <h2 id="q-heading" class="text-6xl md:text-9xl font-black tracking-tighter text-foreground leading-none">
          <span class="inline-block origin-bottom transform will-change-transform">ASCEND</span>
          <br />
          <span class="bg-clip-text text-transparent bg-gradient-to-r from-primary to-accent">BEYOND</span>
        </h2>
        
        <p id="q-sub" class="text-lg md:text-2xl text-muted-foreground max-w-2xl mx-auto font-light tracking-wide pt-6">
          The future of Twitter growth is not just automated. Itâ€™s accelerated.
        </p>
      </div>

      <!-- Magnetic Gravity Button Wrapper -->
      <div class="relative group pt-10">
        <!-- Button Glow/Field -->
        <div class="absolute -inset-8 bg-gradient-to-r from-primary to-accent rounded-full opacity-0 group-hover:opacity-20 blur-2xl transition-opacity duration-500 will-change-opacity"></div>
        
        <a href="/login" id="gravity-btn" class="relative flex items-center justify-center w-64 h-20 rounded-full bg-primary text-primary-foreground font-bold text-xl tracking-wider overflow-hidden transition-transform duration-100 ease-out will-change-transform hover:scale-105 shadow-xl">
           <span class="relative z-10">START NOW</span>
           <div class="absolute inset-0 bg-gradient-to-r from-primary/80 to-accent/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        </a>
        
        <!-- Orbital Rings (Decorative) using theme borders -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] border border-primary/20 rounded-full scale-0 opacity-0 transition-all duration-700 group-hover:scale-100 group-hover:opacity-100 pointer-events-none"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[400px] h-[400px] border border-primary/10 rounded-full scale-0 opacity-0 transition-all duration-1000 delay-100 group-hover:scale-100 group-hover:opacity-100 pointer-events-none"></div>
      </div>

      <!-- Footer / Trust -->
      <div id="q-footer" class="pt-16 opacity-0">
        <p class="text-xs uppercase tracking-[0.4em] text-muted-foreground">
          Join 8,000+ Pilots
        </p>
      </div>

    </div>
  </div>
</section>

<style>
  #quantum-cta {
    perspective: 1000px;
  }
</style>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const initQuantumEcho = () => {
    const section = document.getElementById('quantum-cta');
    const heading = document.getElementById('q-heading');
    const sub = document.getElementById('q-sub');
    const btn = document.getElementById('gravity-btn');
    const footer = document.getElementById('q-footer');

    if (!section || !btn) return;

    // 1. Entrance Animation
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: section,
        start: "top 60%",
        toggleActions: "play none none reverse"
      }
    });

    tl.from(heading?.querySelectorAll('span') || [], {
      y: 100,
      opacity: 0,
      duration: 1.5,
      stagger: 0.2,
      ease: "power4.out"
    })
    .from(sub, {
      y: 20,
      opacity: 0,
      duration: 1,
      ease: "power2.out"
    }, "-=1")
    .from(btn, {
      scale: 0,
      opacity: 0,
      duration: 1.2,
      ease: "elastic.out(1, 0.5)"
    }, "-=0.8")
    .to(footer, {
      opacity: 1,
      y: 0,
      duration: 1
    }, "-=1");

    // 2. Magnetic Button Effect
    const magneticMove = (e: MouseEvent) => {
      const rect = btn.getBoundingClientRect();
      const x = e.clientX - rect.left - rect.width / 2;
      const y = e.clientY - rect.top - rect.height / 2;

      // Move button towards cursor
      gsap.to(btn, {
        x: x * 0.3,
        y: y * 0.3,
        rotation: x * 0.05,
        duration: 0.5,
        ease: "power2.out"
      });

      // Parallax text inside button
      const span = btn.querySelector('span');
      if (span) {
           gsap.to(span, {
            x: x * 0.1,
            y: y * 0.1,
            duration: 0.5,
            ease: "power2.out"
          });
      }
    };

    const magneticLeave = () => {
      gsap.to(btn, {
        x: 0,
        y: 0,
        rotation: 0,
        scale: 1,
        duration: 0.8,
        ease: "elastic.out(1, 0.4)"
      });
      
      const span = btn.querySelector('span');
      if (span) {
          gsap.to(span, {
              x: 0,
              y: 0,
              duration: 0.8,
              ease: "elastic.out(1, 0.4)"
          });
      }
    };

    btn.addEventListener('mousemove', magneticMove);
    btn.addEventListener('mouseleave', magneticLeave);

    // 3. Parallax Background on move (Simplified)
    // We removed the stars elements, so we can animate the background position of the grid if desired,
    // or just leave it clean as per "Satin" request.
  };

  document.addEventListener('astro:page-load', initQuantumEcho);
  initQuantumEcho();

</script>
