---
/**
 * WeekGrid - 7-day schedule grid layout
 * Shows tweets materializing into calendar slots on scroll
 */
import { cn } from "@repo/ui/lib/utils";
import TweetCard from "./TweetCard.astro";

// Sample scheduled tweets data - designed to show product value
const scheduledTweets = [
  { 
    id: 1, 
    day: 0, // Monday
    user: "@growth_sarah", 
    avatar: "S",
    time: "9:00 AM",
    text: "Consistency beats intensity. 30 min/day > 5 hours once a week. Your audience remembers who shows up. üìà", 
    stats: { likes: 847, retweets: 156 }
  },
  { 
    id: 2, 
    day: 1, // Tuesday
    user: "@dev_marcus", 
    avatar: "M",
    time: "12:30 PM",
    text: "Shipped the new dashboard! üöÄ Auto-scheduling saved me 4 hours this week. Now I code instead of post.", 
    stats: { likes: 1203, retweets: 289 }
  },
  { 
    id: 3, 
    day: 2, // Wednesday
    user: "@creator_luna", 
    avatar: "L",
    time: "3:15 PM",
    text: "Thread incoming: How I grew from 100 ‚Üí 10K followers using optimal posting times ‚è∞üßµ", 
    stats: { likes: 2456, retweets: 512 }
  },
  { 
    id: 4, 
    day: 3, // Thursday
    user: "@founder_alex", 
    avatar: "A",
    time: "6:00 PM",
    text: "Friday mindset: Queue is full, weekend is mine. That's the power of batch scheduling. üéØ", 
    stats: { likes: 634, retweets: 98 }
  },
  { 
    id: 5, 
    day: 4, // Friday
    user: "@growth_sarah", 
    avatar: "S",
    time: "8:00 AM",
    text: "Weekend content tip: Schedule your best posts for when YOUR audience is active, not generic peak times.", 
    stats: { likes: 1891, retweets: 367 }
  }
];

const days = [
  { name: "Monday", short: "MON" },
  { name: "Tuesday", short: "TUE" },
  { name: "Wednesday", short: "WED" },
  { name: "Thursday", short: "THU" },
  { name: "Friday", short: "FRI" },
  { name: "Saturday", short: "SAT" },
  { name: "Sunday", short: "SUN" }
];

// Get current day for "today" highlight (0 = Monday for demo)
const todayIndex = 2; // Wednesday as demo "today"

interface Props {
  class?: string;
}

const { class: className } = Astro.props;
---

<div 
  id="week-grid"
  class={cn(
    "week-grid relative w-full max-w-6xl mx-auto",
    "grid grid-cols-5 md:grid-cols-7 gap-3 md:gap-4 lg:gap-6",
    "px-4 md:px-8",
    className
  )}
>
  {days.slice(0, 7).map((day, i) => {
    const tweet = scheduledTweets.find(t => t.day === i);
    const isWeekend = i >= 5;
    
    return (
      <div 
        class={cn(
          "day-column relative flex flex-col items-center",
          isWeekend ? "hidden md:flex opacity-60" : "",
          "opacity-0 translate-y-8"
        )}
        data-day-index={i}
      >
        <!-- Day header -->
        <div 
          class={cn(
            "day-header mb-3 px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider",
            "border transition-all duration-500",
            i === todayIndex 
              ? "bg-primary text-primary-foreground border-primary shadow-lg shadow-primary/30" 
              : "bg-card/80 text-muted-foreground border-border hover:border-primary/40"
          )}
        >
          <span class="hidden lg:inline">{day.name}</span>
          <span class="lg:hidden">{day.short}</span>
        </div>
        
        <!-- Connector -->
        <div class="connector w-0.5 h-6 bg-gradient-to-b from-border via-border/50 to-transparent relative overflow-hidden">
          <div class="connector-glow absolute inset-0 bg-gradient-to-b from-primary to-primary/50 scale-y-0 origin-top transition-transform duration-700"></div>
        </div>
        
        <!-- Card slot -->
        <div 
          class={cn(
            "card-slot relative w-full min-h-[180px] md:min-h-[200px]",
            "rounded-xl border-2 border-dashed transition-all duration-500",
            tweet 
              ? "border-transparent" 
              : i === todayIndex 
                ? "border-primary/20 bg-primary/5" 
                : "border-border/30 bg-card/20"
          )}
        >
          {!tweet && (
            <div class="empty-indicator absolute inset-0 flex items-center justify-center opacity-30">
              <div class="text-center">
                <svg class="h-8 w-8 mx-auto text-muted-foreground mb-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span class="text-[10px] text-muted-foreground">Open</span>
              </div>
            </div>
          )}
          
          {tweet && (
            <TweetCard
              user={tweet.user}
              avatar={tweet.avatar}
              time={tweet.time}
              text={tweet.text}
              likes={tweet.stats.likes}
              retweets={tweet.stats.retweets}
              index={i}
              class="absolute inset-0"
            />
          )}
        </div>
      </div>
    );
  })}
</div>

<!-- Progress indicator: Posts scheduled this week -->
<div id="schedule-progress" class="flex items-center justify-center gap-3 mt-8 opacity-0">
  <div class="h-2 w-48 bg-border/50 rounded-full overflow-hidden">
    <div id="progress-bar" class="h-full w-0 bg-gradient-to-r from-primary via-accent to-primary rounded-full transition-all duration-1000"></div>
  </div>
  <span class="text-sm font-medium text-muted-foreground">
    <span id="post-count">0</span>/5 posts scheduled
  </span>
</div>

<style>
  .day-column {
    will-change: transform, opacity;
  }
  
  .day-column.visible {
    opacity: 1;
    transform: translateY(0);
  }
  
  .day-column.has-tweet .connector-glow {
    transform: scaleY(1);
  }
  
  #schedule-progress.visible {
    opacity: 1;
    transition: opacity 0.5s ease-out;
  }
</style>
