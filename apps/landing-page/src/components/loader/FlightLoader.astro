---
/**
 * FlightLoader.astro
 *
 * A state-of-the-art preloader component featuring a "Firebird" animation.
 * The bird flies from bottom-left to center, hovers/flaps wings, then flies off to top-right.
 *
 * Usage: Import and place in your main Layout or index page.
 */
---

<div
    id="flight-loader"
    class="fixed inset-0 z-[99999] flex items-center justify-center bg-background overflow-hidden pointer-events-none"
>
    <!-- Background Gradient / Glow -->
    <div
        class="absolute inset-0 bg-gradient-to-tr from-background via-primary/5 to-background opacity-50"
    >
    </div>

    <!-- Animation Container -->
    <div class="relative w-full h-full max-w-[1920px] max-h-[1080px] mx-auto">
        <!-- The Firebird SVG -->
        <!-- 
             NOTE: This SVG is a placeholder structure. 
             Replace the paths inside #firebird-body, #wing-left, #wing-right with your actual logo paths.
             Ensure the viewBox aligns with your vector graphics.
        -->
        <svg
            id="firebird-svg"
            class="absolute top-1/2 left-1/2 w-[120px] h-[120px] text-primary drop-shadow-[0_0_15px_rgba(255,100,0,0.5)] opacity-0"
            viewBox="0 0 243.66669 273.45465"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <g id="firebird-group" transform="translate(-426.59997,-163.16187)">
                <g transform="translate(0.26664786,0.49520316)">
                    <!-- Right Wing (g5) -->
                    <g id="wing-right">
                        <path
                            style="fill:#e05200;fill-opacity:0.956952;stroke:none"
                            d="m 508,370 c -20.97275,22.94781 -57.39224,40.46861 -75.59619,66.12132 20.95044,-3.73456 48.90985,-20.14866 68.59619,-28.54878 9.19452,-3.92328 23.07757,-7.55635 33.23077,-7.55745 L 528,398 l -3,-9 -10,-9 -3,-2 h 1 v 2 h 1 l -1,-6 h 1 l 1,2 1,-5 -8,-1 m 9,0 v 2 l 2,-2 z"
                            id="path1319"></path>
                        <path
                            style="fill:#e05200;fill-opacity:0.956952;stroke:none"
                            d="m 512,335 1,1 -1,-1 m 17.69064,10.73483 c -10.2752,12.9234 -43.54178,39.53478 -55.36127,52.35921 l 10.77805,5.84709 L 516,371 l -1,5 -1,-2 h -1 l 1,6 h -1 v -2 h -1 l 3,2 10,9 2.30936,11.48613 L 543,395 v -1 h -4 -1 l -2,-12 0.0312,-0.0781 L 528.96875,376 529,379 c -1.18781,-2.44159 -1.78778,-3.45178 1.25,-3.84375 -4.80658,-9.94492 9.61023,-13.09436 7.75,-23.15625 3.6134,-1.02576 5.34497,-2.26907 6,-6 l 14,-11 z"
                            id="path1214"></path>
                        <path
                            style="fill:#e05200;fill-opacity:0.956952;stroke:none"
                            d="M 544.1875,344.8125 538,352 c 0.37268,9.54095 -14.28833,13.88745 -8,23 l -3,1 2,3 v -3 l 7,6 2,12 h 1 4 v 1 l -13,4 v 1 c 8.51917,-0.006 16.12793,-0.66858 23,-6 l 1.78986,-3.38128 c 2.86292,-0.61728 2.18328,-3.07923 3.77032,-5.62412 3.62225,-5.80838 3.84992,-12.3504 -1.07715,-17.6312 -3.12225,-3.3464 -9.99536,-5.72973 -7.61035,-11.64889 C 555.05951,342.84164 570.92664,337.03168 579,327 c -13.58643,4.52136 -23.28296,9.63159 -34.8125,17.8125 z"
                            id="path1183"></path>
                        <path
                            style="fill:#df5700;fill-opacity:0.971301;stroke:none;stroke-width:1.11062"
                            d="m 563.99564,302 c 4.03079,5.50293 13.08516,17.32019 10.49029,23.99924 -2.02669,5.21655 -10.56098,8.19998 -15.21483,11.73379 -9.16512,6.95935 -12.42995,12.55207 -13.77764,22.26697 l 6.16739,3 c -0.90063,4.41077 2.01231,6.8158 2.70494,11 1.16933,7.06409 -5.18364,12.8504 -11.33929,17 l 4.93392,2 v 1 l -12.33479,4 v 1 c 16.40284,-1.79074 31.49548,-7.0965 45.59015,-13.93442 6.04544,-2.93289 25.6765,-12.00537 28.47644,-17.76717 l -27.5507,14.95159 19.7415,-9.72882 4.76616,-2.0957 L 601,369 l -7.40087,3 2.46696,-4 h -6.1674 l 2.46696,-3 -6.16739,-7 c 0,-15.46492 4.24589,-33.75177 -6.55454,-44.5522 -3.14891,-3.14891 -0.48038,-10.11427 -5.24256,-12.28807 -2.59607,-1.18503 -7.5409,0.68082 -10.40552,0.84027 z"
                            id="path1018"></path>
                        <path
                            style="fill:#df5700;fill-opacity:0.971301;stroke:none"
                            d="m 598,285 -23.5,16.17969 c 2.66318,10.41257 4.54215,17.42784 9.94324,26.7828 1.00408,1.73912 -0.0394,4.02088 -0.16083,6.03751 -0.21223,3.52512 -2.69287,10.4368 1.71759,11 l -1.16551,3.30936 -1.08449,19.85575 c -0.0235,4.0629 15.74683,6.19278 20.875,3 C 609.84753,367.91358 603.05665,355.7111 602,357 c -1.07757,1.31443 -5,1 -5,1 l 7.57452,2.41421 c 0,0 -0.33882,-0.64991 -0.57452,-0.41421 -0.0737,0.0737 -0.27407,-0.0125 -0.37788,0.0329 C 602.73031,360.42281 601,360 601,360 l 5,7 c 0,0 -0.47097,-2.52506 -1,-2 -2.65319,2.63327 0.8051,-0.27041 1,0 1.23268,1.71025 -2,6 -2,6 v 1 c 14.82227,-6.9313 21.09045,-27.23035 27.00928,-41 2.73864,-6.37122 6.37243,-12.1868 7.99072,-19 l -2,1 3,-6 h -3 v -4 l -5,-1 c 0.0271,-2.61609 -0.43213,-2.55362 -3,-2 l 3,-3 v -1 h -6 l -9,-10 -3,3 -6,-1 3,-4 z"
                            id="path852"></path>
                        <path
                            style="fill:#e05200;fill-opacity:0.956952;stroke:none"
                            d="M 574.41406,301.32812 598,285 l 13,-1 -3,4 6,1 3,-3 9,10 h 6 v 1 h -3 v 3 l 3.13258,1.2539 L 632,302 l 5,1 v 4 h 3 l -3,6 1.33709,1.47487 L 639,313 626.71837,340.60225 c 0.73903,0.13139 -3.3652,-2.03431 1.39775,-1.67938 0.9958,-2.56672 2.78202,-4.06622 4.00246,-8.73415 C 634.87645,319.64046 641.48841,307.24619 648,305 c 2.35339,-10.09088 16.49536,-11.41998 22,-19 -14.54865,0.64331 -22.96143,-8.63254 -36,-11.48148 -20.97107,-4.58218 -43.11707,11.97899 -55.96637,28.40398 M 460,274 l 1,1 z"
                            id="path759"></path>
                    </g>
                    <!-- Left Wing (g3) -->
                    <g id="wing-left">
                        <path
                            style="fill:#df5700;fill-opacity:0.972549;stroke:none"
                            d="m 456,208 -6,-2 -1,3 c -4.21674,-1.70453 -9.2493,0.38928 -12,4 l 3,-1 c 2.11209,8.2916 14.04529,13.51691 20.40973,18.61111 12.66016,10.13343 25.66385,19.86246 38.59027,29.64042 7.98416,6.03946 17.12262,11.4739 23,19.74847 l -18,-9 -38,-22 -15,-9 -11.19975,-6.89797 c 7.04013,14.70544 3.03907,24.67933 15.94975,34.8864 20.58774,16.27648 50.25275,31.14841 66.25,47.01157 -19.55658,-8.7981 -42.07886,-19.70612 -62,-28 -0.55142,4.69995 3.63179,13.6382 5.39113,17.94975 2.82447,6.92184 5.71169,10.23292 9.59793,13.61503 8.36707,7.28168 23.25134,11.17574 35.01094,17.09711 6.21545,3.1297 15.31727,7.36183 22.23744,8.21171 5.95117,0.7309 15.26883,-1.0015 20.61872,-3.3724 6.39283,-2.83311 23.7464,-10.12334 27.00993,-14.66509 2.35633,-3.27924 -1.98917,-11.58852 -3.36454,-15.10128 -4.67938,-11.95151 -10.36032,-25.4998 -15.44253,-37.32582 C 555.61761,260.74727 541.37396,256.69189 530,249.41357 522.73462,244.76437 514.53516,241.35818 507.61496,236.23535 502.66211,232.56888 497.49588,226.60638 491,227 l -6,-4 1,3 -7,-2 -11,3 v -3 l -5,-1 3,-2 v -1 l -6,2 -1,-5 h 1 v 3 c 3.58566,-3.28751 0.35727,-7.80731 -2,-11 h 4 v -3 h -2 l 1,-2 z"
                            id="path116"></path>
                        <path
                            style="fill:#df5700;fill-opacity:0.972549;stroke:none"
                            d="m 446,197 2,3 -6,1 1,-2 h -1 l -3,5 h -1 v -3 l -4,1 2,2 -2,4 v 1 c 4.65576,8.16864 13.9202,14.35184 22,19 l -16,-16 -3,1 2.1875,-1.99219 L 449,209 l 1,-3 6,2 5.99437,-1.85658 L 462,206 v 3 h -4 c 2.00656,3.80905 4.51196,6.90015 2,11 v -3 h -1 l 1,5 6,-2 v 1 l -3,2 5,1 v 3 l 11,-3 7,2 -1,-3 6,4 20.93405,12.53932 L 519,243 v -1 c 6.00493,9.65025 -28.86568,-25.67733 -44,-26 -5.15662,-9.62997 -18.68655,-16.56854 -29,-19 z"
                            id="path80"></path>
                        <path
                            style="fill:#df5700;fill-opacity:0.972549;stroke:none"
                            d="m 429,182 c 0.0708,8.55414 0.936,22.33823 5.02393,29.96063 2.55389,4.76203 8.68496,7.89792 12.97607,10.90048 7.95789,5.56827 16.0314,11.93979 24.6875,16.35764 L 471,239 434,209 v -1 c 3.83289,-1.56152 2.43705,-1.07259 2.09922,-3.69085 L 438,201 v 3 h 1 l 4,-5 -1,2 6,-1 -2,-3 c 10.92825,3.93912 21.55341,9.79376 29,19 l 23,12 -16,-11.74152 -35,-23.16665 z"
                            id="path31"></path>
                        <path
                            style="fill:#df5700;fill-opacity:0.972549;stroke:none"
                            d="m 428,180 v 5 h 1 z"
                            id="path25"></path>
                        <path
                            style="fill:#eccaa2;stroke:none"
                            d="m 426.33334,179.66666 0.33332,0.66668 z"
                            id="path21"></path>
                    </g>
                    <!-- Body (g4) -->
                    <g id="firebird-body">
                        <path
                            style="fill:#df5700;fill-opacity:0.972549;stroke:none"
                            d="m 559,223 2,3 -2,-3 m 4,0 2,4 -4,1 -3,-1 v 4 l -4,-2 v 4 h -4 l 12,15 -22,-9 17.4873,7.79556 -15.4106,-9.56939 -9.02124,-5.14862 L 536,237 l -6,-2 v 1 c 3.41526,7.32933 16.17275,17.27342 22.94163,22.39613 C 571.79008,261.7863 568.86505,275.58881 575,290 c 6.30963,-3.51282 17.53241,-9.62262 20.93286,-16.18442 1.77344,-3.42218 -0.0609,-9.22918 -0.73688,-12.81558 -2.0202,-10.71881 -5.6922,-27.76154 -19.28973,-29.25 13.9281,6.32373 -0.47546,-5.63535 -4.34375,-5.125 z"
                            id="path237"></path>
                        <path
                            style="fill:#df5700;fill-opacity:0.972549;stroke:none"
                            d="m 470,208 1,1 -1,-1 m 36,0 2.91165,13.16457 c 0,0 13.23112,10.65965 12.85612,10.34715 7.60172,7.19987 16.31423,13.40002 25.5782,19.10386 -5.72296,-7.95578 -8.56637,-5.17628 -11.18972 L 531,230 l -2,3 h 4 l 3,3 -1.1875,-2.34375 L 548,241 533.02777,229.13889 Z"
                            id="path138"></path>
                        <path
                            style="fill:#df5700;fill-opacity:0.972549;stroke:none"
                            d="m 528,197 -6,4 -3,-2 c -0.004,8.53146 8.74814,14.29885 14.67517,19.20526 8.89512,7.3634 16.99004,17.67205 24.26233,24.63849 L 541,221 l 2,3.35876 c 0,0 7.36273,11.83485 13.23052,11.62827 1.52666,-0.0538 3.22097,-3.25996 3.22097,-3.25996 0,0 -8.24178,-8.72792 -9.25825,-10.05375 0,0 -0.40941,-0.87037 -0.81196,-1.06066 -1.99055,-0.94099 -6.6014,0.22617 -6.6014,0.22617 l 9.92202,10.18719 c 6.04989,-0.6357 16.92161,-9.70338 24.39096,-2.91349 5.945,5.40419 10.48335,11.42356 13.20003,14.97586 l -0.19324,-0.17678 c -2.23505,-5.92191 -7.34806,-10.47817 -12.10044,-14.50188 -9.07526,-7.68384 -17.89167,-15.68057 -27.02393,-23.29398 C 546.52203,202.40317 541.00085,195.63522 535,200 h -1 z"
                            id="path83"></path>
                        <path
                            style="fill:#df5700;fill-opacity:0.972549;stroke:none"
                            d="m 503,164 1.56018,26.82947 L 517,204.00076 547.5,231.1875 C 541.04431,220.86673 519.79126,211.39981 519,199 l 3,2 6,-4 6,3 h 1 l 7,-1 c -9.495,-12.41409 -26.13458,-26.04395 -39,-35 z"
                            id="path11"></path>
                        <path
                            style="fill:#d6a79e;stroke:none"
                            d="m 503,163 -1,4 h 1 v -3 l 7,6 z"
                            id="path9"></path>
                        <path
                            style="fill:#eccaa2;stroke:none"
                            d="m 502.33334,162.66666 0.33332,0.66668 z"
                            id="path8"></path>
                    </g>
                </g>
            </g>
        </svg>

        <!-- Motion Path Visualizer (Optional: Hidden by default, useful for debugging) -->
        <svg
            class="absolute inset-0 w-full h-full pointer-events-none opacity-0"
            preserveAspectRatio="none"
        >
            <path
                id="flight-path"
                d=""
                fill="none"
                stroke="red"
                stroke-width="2"></path>
        </svg>
    </div>

    <!-- Optional Loading Text -->
    <div
        class="absolute bottom-10 left-1/2 -translate-x-1/2 text-muted-foreground text-sm tracking-widest uppercase animate-pulse"
    >
        Initializing System...
    </div>
</div>

<script>
    import gsap from "gsap";
    import { MotionPathPlugin } from "gsap/MotionPathPlugin";

    gsap.registerPlugin(MotionPathPlugin);

    // Main Animation Logic
    const initLoader = () => {
        const loader = document.getElementById("flight-loader");
        const bird = document.getElementById("firebird-svg");
        const wingLeft = document.getElementById("wing-left");
        const wingRight = document.getElementById("wing-right");

        if (!loader || !bird) return;

        // 1. Initial State (Start at Bottom-Left relative to center)
        const startX = -window.innerWidth * 0.45;
        const startY = window.innerHeight * 0.45;

        gsap.set(bird, {
            opacity: 0,
            scale: 0.5,
            xPercent: -50,
            yPercent: -50,
            x: startX,
            y: startY,
        });

        // 2. Define the Flight Path
        const masterTl = gsap.timeline({
            onComplete: () => {
                // Remove loader from DOM or hide it
                gsap.to(loader, {
                    opacity: 0,
                    duration: 0.8,
                    onComplete: () => {
                        loader.style.display = "none";
                        // Dispatch event that loading is done
                        window.dispatchEvent(
                            new CustomEvent("loader-complete"),
                        );
                    },
                });
            },
        });

        // === PHASE 1: ENTER & FLY TO CENTER ===
        // Fly from current position (bottom-left) to (0,0) (center)
        masterTl.to(bird, {
            motionPath: {
                path: [
                    { x: startX * 0.5, y: startY * 0.5 }, // Control point for curve
                    { x: 0, y: 0 }, // Center
                ],
                curviness: 1.5,
                autoRotate: true,
                alignOrigin: [0.5, 0.5],
            },
            opacity: 1,
            duration: 2,
            ease: "power2.out",
            scale: 1.5, // Grow as it approaches
        });

        // === PHASE 2: HOVER & FLAP ===
        // We want the bird to stay in center and flap wings.
        // The wing flapping is a separate loop running concurrently or triggered here.

        // Note: Wing flapping disabled for this detailed SVG logo
        // The logo's wings are integrated into the design and don't animate separately

        // Add a "Hover" moment in the master timeline
        // We do this by adding a dummy tween or just a delay
        masterTl.to(bird, {
            y: "+=20", // Slight hover up/down
            yoyo: true,
            repeat: 3,
            duration: 0.5,
            ease: "sine.inOut",
        });

        // === PHASE 3: FLY AWAY ===
        masterTl.to(bird, {
            motionPath: {
                path: [
                    {
                        x: window.innerWidth * 0.5,
                        y: -window.innerHeight * 0.5,
                    }, // Top Right
                ],
                curviness: 1,
                autoRotate: true,
            },
            duration: 1.5,
            scale: 0.5, // Shrink away
            ease: "power2.in",
        });

        // Fade trail
        masterTl.to(bird, { opacity: 0, duration: 0.5 }, "-=0.5");
    };

    // Run on load
    window.addEventListener("load", () => {
        // Small delay to ensure everything is ready
        setTimeout(initLoader, 100);
    });

    // Fallback if load already fired
    if (document.readyState === "complete") {
        initLoader();
    }
</script>
