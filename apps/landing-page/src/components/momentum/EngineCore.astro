---
import { Image } from "astro:assets";
import logo from "../../assets/favicon.svg";

interface Props {
  class?: string;
}

const { class: className } = Astro.props;
---

<div class:list={["relative flex items-center justify-center", className]} id="engine-core-container">
  <!-- Outer Glow Rings -->
  <div class="absolute inset-0 rounded-full border border-primary/20 scale-150 animate-pulse-slow"></div>
  <div class="absolute inset-0 rounded-full border border-primary/10 scale-[2.5] animate-pulse-slow delay-700"></div>

  <!-- Central Glass Core -->
  <div class="relative w-32 h-32 rounded-full glass-card border-2 border-primary/50 flex items-center justify-center shadow-[0_0_50px_hsl(var(--primary)/0.3)]">
    <!-- Inner Spinning Element -->
    <div class="absolute inset-2 rounded-full border-t-2 border-primary animate-spin-slow"></div>

    <!-- TweetBatch Symbol (Custom Logo) -->
    <div class="bird-perspective">
      <Image
        id="engine-bird"
        src={logo}
        alt="TweetBatch"
        class="size-20 drop-shadow-[0_0_10px_hsl(var(--primary)/0.8)]"
      />
    </div>
  </div>
</div>

<style>
  .glass-card {
    background: hsl(var(--background) / 0.4);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .bird-perspective {
    perspective: 1000px;
    transform-style: preserve-3d;
  }

  #engine-bird {
    transform-style: preserve-3d;
    will-change: transform, filter;
  }

  @keyframes pulse-slow {
    0%, 100% { transform: scale(1.5); opacity: 0.2; }
    50% { transform: scale(1.7); opacity: 0.4; }
  }

  .animate-pulse-slow {
    animation: pulse-slow 4s ease-in-out infinite;
  }

  .animate-spin-slow {
    animation: spin 8s linear infinite;
  }
</style>

<script>
  import gsap from "gsap";

  // Initialize bird animation with GSAP
  const initBirdAnimation = () => {
    const bird = document.getElementById("engine-bird");
    if (!bird) return;

    // Create animation context for proper cleanup
    const ctx = gsap.context(() => {
      // Set initial state
      gsap.set(bird, {
        transformOrigin: "center center",
      });

      // Breathing scale effect
      gsap.to(bird, {
        scale: 1.15,
        duration: 3,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1,
      });

      // 3D rotation on Y-axis (offset timing for organic feel)
      gsap.to(bird, {
        rotationY: 8,
        duration: 5,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1,
        delay: 0.5,
      });

      // 3D rotation on X-axis
      gsap.to(bird, {
        rotationX: -5,
        duration: 6,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1,
        delay: 0.8,
      });

      // Floating motion (vertical)
      gsap.to(bird, {
        y: -12,
        duration: 4,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1,
        delay: 0.25,
      });

      // Floating motion (horizontal)
      gsap.to(bird, {
        x: 5,
        duration: 4.5,
        ease: "sine.inOut",
        yoyo: true,
        repeat: -1,
        delay: 0.15,
      });
    });

    // Return cleanup function
    return () => ctx.revert();
  };

  // Initialize with IntersectionObserver for performance
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          initBirdAnimation();
          observer.disconnect();
        }
      });
    },
    { threshold: 0.1 }
  );

  const container = document.getElementById("engine-core-container");
  if (container) {
    observer.observe(container);
  }
</script>
